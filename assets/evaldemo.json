{
  "#upstream": true,
  "_hl": "eval",
  "update": "@date yyyy-MM-dd HH:mm:ss",
  "redis1@redis-instance": {
    "addr": "localhost:6379",
    "password": "",
    "db": 0
  },
  "name": "@redis redis1 name",
  "db1@db-instance": {
    "dsn": "user:pass@tcp(127.0.0.1:3306)/api_statistical?charset=utf8mb4&parseTime=true&loc=Local&timeout=10s&writeTimeout=10s&readTimeout=10s"
  },
  "counts@db-query": {
    "instance": "db1",
    "query": [
      "select SUM(request_count_outside)",
      "from product_gw_pv_rt"
    ],
    "resultType": "map"
  },
  "timeStart@time": {
    "value": "today",
    "unit": "s",
    "truncate": "24h"
  },
  "timeEnd@time": {
    "value": "tomorrow",
    "unit": "s",
    "truncate": "24h"
  },
  "provinceCount@db-query": {
    "instance": "db1",
    "query": [
      "select c.province as province, c.count as count from",
      "(select province,sum(call_count) as count from product_region_request_stat",
      "where request_time >= #timeStart# AND request_time < #timeEnd#",
      "GROUP BY province ) as c, province p",
      "where c.province = p.province order BY c.count desc",
      "limit 10"
    ],
    "resultType": "json"
  },
  "totalStat": {
    "requestCountOutside": "@db-value toInt(counts.request_count_outside)/1024/1024"
  },
  "provinceStat": "@db-value provinceCount"
}
