# gossh -e=1 -c testdata/centos_build.toml -H "user:xxx@192.168.1.75" at ..

#printConfig = true
#passphrase="xxxx"

# 全部命令都默认成远程执行，相当于自动添加了%host标识。
globalRemote = true
cmdTimeout = "300s"
# confirm = true
# exec mode(0: cmd by cmd, 1 host by host).
execMode = 0

cmds = [
  "%local date '+%Y%m%d%H%M%S' => @Today",
  "%local pwd && go mod download && go mod vendor", # "go mod vendor -v",
  "%local cd .. && rm -fr httplive.tar.gz && tar czf httplive.tar.gz httplive",
  "%ul httplive.tar.gz rigagasrc",
  "cd rigagasrc",
  "rm -fr httplive",
  "tar zxf httplive.tar.gz --warning=no-timestamp --exclude .git",
  "cd httplive", # "go build -v -x -mod vendor -o rigaga  -ldflags=' -w -s -X main.branch=HEAD -X main.commit=@Today' ./cmd/rigaga",
  "go build -mod vendor -o httplive ./cmd/httplive",
  "ls -lh ./httplive",
  "./httplive -v",
  "../upx-3.96-amd64_linux/upx httplive",
  "ls -lh ./httplive",
  "%dl rigagasrc/httplive/httplive @Today/",
  "%local ls -lhd $PWD/@Today/*",
]
